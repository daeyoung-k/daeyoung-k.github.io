---
title: PostGis 함수 사용하기
author: kane
date: 2025-12-05
categories:
  - SpringBoot
tags:
  - kotlin
  - querydsl
  - postgresql
render_with_liquid: false
pin: false
description:
---
## 주제
>`QueryDsl` 으로 `PostgreSql` 의 `geography(Point, 4326)` 컬럼을 조회할때 발생하는 오류에 대해서 알아봅니다.  

## 내용

PostgreSql 에서 ST_DWithin 함수를 사용하여 특정 거리 이내에 있는 데이터를 조회할때의 예시
```sql
ST_DWithin({특정컬럼}, ST_MakePoint({경도}, {위도}), {거리})
-- 5000: 5km
```
- ST_DWithin 함수는 boolean 함수이다. 참 & 거짓

Hibernate(JPA/HQL)는 PostGis의 함수인 ST_DWithin을 **모름**  
그래서 QueryDsl 에서 사용하려면 Hibernate 에게 ST_DWithin는 함수야 그리고 boolean 타입인지 알려줘야 함.

사용 예시  
```kotlin
// boolean 타입의 함수이니 booleanTemplate를 사용한다.
Expressions.booleanTemplate(  
    "function('ST_DWithin', {0}, function('ST_MakePoint', {1}, {2}), {3}) = true",  
    board.location,  
    longitude,  
    latitude,  
    distance * 1000  
)
```

- 일반 문자열로 만들어서 적용하기 (❌ 에러발생)
  `ST_DWithin({특정컬럼}, ST_MakePoint({경도}, {위도}), {거리})` 
  Hibernate는 Object -> boolean 아님    
  
- 일반 함수라고 알려주고 적용하기 (❌ 에러발생)
  `function('ST_DWithin', {0}, function('ST_MakePoint', {1}, {2}), {3})` 
  Hibernate는 Object -> boolean 아님  
  
- 이건 boolean 표현식이야 알려주고 적용하기 (✅ 정상)
  `function('ST_DWithin', {0}, function('ST_MakePoint', {1}, {2}), {3}) = true`
  boolean 비교로 인식됨
  
**즉, = true 는 Hibernate에게 boolean 이라고 “표시해주는 것”**
